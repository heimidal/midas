<script type="text/javascript">
//  var selection = $('midas-iframe-window').contentWindow.getSelection();
//
//  console.log('selection', selection);
//
//  $('midas_link_text').value = selection;
//  // need to have the target select the current target here...
//
//  if (selection.rangeCount) {
//
//    var range = selection.getRangeAt(0);
//    var node = range.commonAncestorContainer;
//    var contents = range.cloneContents();
//
//    var anchor;
//
//    if (contents.childNodes.length == 1 && contents.childNodes[0].tagName == 'A') {
//      anchor = contents.childNodes[0];
//    } else {
//      anchor = Element.up(node, 'a');
//      if (!anchor) {
//        // wrap the selection in an anchor
//      }
//    }
//    $('midas_link_url').value = anchor.href;
//  }

  window['midas_modal_submit'] = function(e) {    
    var generator = $('midas_link_generator');
    var link = '<a href="' + generator.down('#midas_link_url').value + '" target="' + generator.down('#midas_link_target').value + '">' + generator.down('#midas_link_text').value + '</a>';
    Midas.fire('action', {action: 'insertHTML', options: {value: link}});
    Midas.modal.hide();
    e.stop();
  };
</script>

<div id="midas_link_generator">
  <p><label for="midas_link_text">Link Text</label><input id="midas_link_text"/></p>
  <p><label for="midas_link_url">Link URL</label><input id="midas_link_url" value="http://"/></p>
  <p>
    <label for="midas_link_target">Link Target</label>
    <select name="midas_link_target" id="midas_link_target">
      <option value="_blank" selected='selected'>Blank</option>
      <option value="_self">Self</option>
      <option value="_parent">Parent</option>
      <option value="_top">Top</option>
    </select>
  </p>
</div>

<div id="midas_character_controls" class="midas-modal-controls">
  <input type="submit" value="Insert Link">
</div>
